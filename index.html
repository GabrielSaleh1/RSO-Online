<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>RSO Online</title>
<style>
  :root {
    --bg:#0f172a; --panel:#111827; --muted:#9ca3af; --accent:#60a5fa;
    --btn:#2563eb; --btnH:#1e40af; --line:#324156; --field:#0b1220;
  }

  /* ===== TELA ===== */
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
       background:var(--bg); color:#e5e7eb; margin:0; padding:24px;}
  .wrap{max-width:980px;margin:0 auto}
  h1{margin:0 0 18px; color:#60a5fa; text-align:center}
  .grid{display:grid; gap:12px}
  .panel{background:var(--panel); border-radius:12px; padding:16px; box-shadow:0 8px 24px #0005; overflow:hidden}
  label{font-weight:600; font-size:14px; display:block; margin:6px 0}

  /* linhas de campos: robustas e responsivas */
  .row{display:flex; flex-wrap:wrap; gap:12px}
  .row > div{flex:1 1 260px; min-width:220px}

  input,textarea{
    box-sizing:border-box; width:100%;
    padding:10px 12px; border-radius:10px; border:1px solid var(--line);
    background:var(--field); color:#e5e7eb; display:block;
  }
  textarea{min-height:70px; resize:vertical}
  .muted{color:var(--muted); font-size:12px}

  .btn{background:var(--btn); border:none; color:white; padding:10px 14px; border-radius:10px; font-weight:600; cursor:pointer}
  .btn:hover{background:var(--btnH)}
  .btn-sec{background:#0b1220; border:1px solid var(--line)}

  .list{display:grid; gap:10px}
  /* itens dinâmicos com add/remover */
  .item,.item-2{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
  .item-2 input[type="time"]{width:90px}
  .item button,.item-2 button{flex-shrink:0; height:38px}
  .pill{padding:6px 10px; border:1px dashed var(--line); border-radius:8px; cursor:pointer; text-align:center}

  @media (max-width:720px){ .row > div{flex:1 1 100%; min-width:unset} }

  /* ===== IMPRESSÃO (A4 em “página”) ===== */
  @page { size: A4; margin: 14mm; }
  @media print {
    body{ background:#fff; color:#000; -webkit-print-color-adjust:exact; print-color-adjust:exact; }
    #form-area{ display:none !important; }
    #sheet{ display:block !important; }
  }
  /* folha que será impressa */
  #sheet{
    display:none;               /* visível só no print */
    width:100%;
    background:#fff;
    color:#000;
    border:1px solid #000;
    border-radius:4px;
    padding:14mm;
    box-sizing:border-box;
  }
  #sheet h2{ margin:0 0 10px; text-align:center; font-size:18px; }
  #sheet pre{
    white-space:pre-wrap;
    font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;
    font-size:12.5px;
    margin:0;
  }
</style>
</head>
<body>
<div class="wrap">

  <h1>Relatório de Serviço Operacional</h1>

  <!-- ===== FORM NA TELA ===== -->
  <div id="form-area" class="grid">
    <div class="panel grid">
      <div class="row">
        <div>
          <label>Nº do RSO</label>
          <input id="numero" placeholder="0169" />
        </div>
        <div>
          <label>Data/Hora</label>
          <input id="datahora" type="datetime-local" />
        </div>
      </div>
      <div>
        <label>Rota</label>
        <input id="rota" placeholder="91136" />
      </div>
    </div>

    <div class="panel grid">
      <div class="row">
        <div>
          <label>Motorista</label>
          <input id="motorista" placeholder="Cabo PM Ducati" />
        </div>
        <div>
          <label>Encarregado</label>
          <input id="encarregado" placeholder="2º Sgt Rangel" />
        </div>
      </div>
      <div class="row">
        <div>
          <label>Segurança</label>
          <input id="seguranca" placeholder="EST SD PM Jonny" />
        </div>
        <div>
          <label>Auxiliar</label>
          <input id="auxiliares" placeholder="EST SD PM Joãozinho" />
        </div>
      </div>
    </div>

    <div class="panel grid">
      <label>Ilícitos</label>
      <div id="list-ilicitos" class="list"></div>
      <div class="pill" onclick="addIlicito()">+ adicionar ilícito</div>
    </div>

    <div class="panel grid">
      <label>Veículos</label>
      <div id="list-veiculos" class="list"></div>
      <div class="pill" onclick="addVeiculo()">+ adicionar veículo</div>
    </div>

    <div class="panel grid">
      <label>Ocorrências</label>
      <div id="list-ocorrencias" class="list"></div>
      <div class="pill" onclick="addOcorrencia()">+ adicionar ocorrência</div>
      <div class="muted">Dica: descreva com verbo no passado e detalhe local/apoio.</div>
    </div>

    <div class="panel grid">
      <label>Abordados</label>
      <div id="list-abordados" class="list"></div>
      <div class="pill" onclick="addAbordado()">+ adicionar abordado</div>
    </div>

    <div class="panel grid">
      <div class="row">
        <div>
          <label>Ocorrências (qtd)</label>
          <input id="res-oc" type="number" min="0" value="0" />
        </div>
        <div>
          <label>Apoios (qtd)</label>
          <input id="res-ap" type="number" min="0" value="0" />
        </div>
      </div>
      <div>
        <label>Ações (qtd)</label>
        <input id="res-ac" type="number" min="0" value="0" />
      </div>
    </div>

    <div class="grid panel">
      <button class="btn btn-sec" id="printBtn">Imprimir / PDF</button>
    </div>
  </div>

  <!-- ===== FOLHA A SER IMPRESSA ===== -->
  <div id="sheet">
    <h2>Relatório de Serviço Operacional</h2>
    <pre id="sheet-text"></pre>
  </div>

</div>

<script>
  const $ = (id) => document.getElementById(id);
  const pad2 = (n) => String(n).padStart(2, '0');

  // Data/Hora default
  (function initDate(){
    const d = new Date();
    const z = (n)=>String(n).padStart(2,'0');
    $('datahora').value = `${d.getFullYear()}-${z(d.getMonth()+1)}-${z(d.getDate())}T${z(d.getHours())}:${z(d.getMinutes())}`;
  })();

  // ===== listas dinâmicas =====
  function addIlicito(val=''){
    const wrap = document.createElement('div');
    wrap.className = 'item';
    wrap.innerHTML = `
      <input placeholder="ex.: 02x Bomba caseira" value="${val}"/>
      <button class="btn btn-sec" type="button">remover</button>`;
    wrap.querySelector('button').onclick = ()=> wrap.remove();
    $('list-ilicitos').appendChild(wrap);
  }
  function addVeiculo(val=''){
    const wrap = document.createElement('div');
    wrap.className = 'item';
    wrap.innerHTML = `
      <input placeholder="ex.: BMW R1250 HP - Branca - 57URU265 - Apreendida" value="${val}"/>
      <button class="btn btn-sec" type="button">remover</button>`;
    wrap.querySelector('button').onclick = ()=> wrap.remove();
    $('list-veiculos').appendChild(wrap);
  }
  function addOcorrencia(h='', texto=''){
    const wrap = document.createElement('div');
    wrap.className = 'item-2';
    wrap.innerHTML = `
      <input type="time" value="${h}">
      <input placeholder="Descreva a ocorrência" value="${texto}">
      <button class="btn btn-sec" type="button">remover</button>`;
    wrap.querySelector('button').onclick = ()=> wrap.remove();
    $('list-ocorrencias').appendChild(wrap);
  }
  function addAbordado(nome=''){
    const wrap = document.createElement('div');
    wrap.className = 'item';
    wrap.innerHTML = `
      <input placeholder="ex.: Renato Cruz – 4910 – BOPM – Cb Ducati 20:14" value="${nome}">
      <button class="btn btn-sec" type="button">remover</button>`;
    wrap.querySelector('button').onclick = ()=> wrap.remove();
    $('list-abordados').appendChild(wrap);
  }

  // inicia com 1 item em cada lista
  if(!$('list-ilicitos').children.length) addIlicito();
  if(!$('list-veiculos').children.length) addVeiculo();
  if(!$('list-ocorrencias').children.length) addOcorrencia();
  if(!$('list-abordados').children.length) addAbordado();

  // ===== formata texto para a folha =====
  function coletar(){
    const ilicitos = [...$('list-ilicitos').querySelectorAll('input')].map(i=>i.value).filter(Boolean);
    const veiculos = [...$('list-veiculos').querySelectorAll('input')].map(i=>i.value).filter(Boolean);
    const ocorrencias = [...$('list-ocorrencias').children].map(div=>{
      const ins = div.querySelectorAll('input'); return {h:ins[0].value, t:ins[1].value};
    }).filter(o=>o.t);
    const abordados = [...$('list-abordados').querySelectorAll('input')].map(i=>i.value).filter(Boolean);

    return {
      numero:$('numero').value,
      datahora:$('datahora').value,
      rota:$('rota').value,
      motorista:$('motorista').value,
      encarregado:$('encarregado').value,
      seguranca:$('seguranca').value,
      auxiliares:$('auxiliares').value,
      ilicitos, veiculos, ocorrencias, abordados,
      resOc:Number($('res-oc').value||0),
      resAp:Number($('res-ap').value||0),
      resAc:Number($('res-ac').value||0),
    };
  }

  function formatar(d){
    const dt = d.datahora ? new Date(d.datahora) : new Date();
    const dd = pad2(dt.getDate())+'/'+pad2(dt.getMonth()+1)+'/'+dt.getFullYear();
    const hh = pad2(dt.getHours())+':'+pad2(dt.getMinutes());

    const bloc = (arr)=> arr.length ? arr.map(x=>`- ${x}`).join('\n') : '';
    const blocOcc = d.ocorrencias.length
      ? d.ocorrencias.sort((a,b)=>(a.h||'').localeCompare(b.h||''))
          .map(o=> o.h ? `- ÀS ${o.h}: ${o.t}` : `- ${o.t}`).join('\n')
      : '';

    return `
— RELATÓRIO DE SERVIÇO —
Nº: ${d.numero} / DataHora: ${dd} ${hh}

# ROTA - ${d.rota}

Motorista: ${d.motorista}
Encarregado: ${d.encarregado}
Segurança: ${d.seguranca}
Auxiliar(es): ${d.auxiliares}

# ILÍCITOS #
${bloc(d.ilicitos)}

# VEÍCULOS #
${bloc(d.veiculos)}

# OCORRÊNCIAS #
${blocOcc}

# ABORDADOS #
${bloc(d.abordados)}

# RESULTADO #
${d.resOc}x Ocorrência.
${d.resAp}x Apoio.
${d.resAc}x Ação.
`.trim();
  }

  function atualizarFolha(){
    $('sheet-text').textContent = formatar(coletar());
  }

  // sempre atualizar a folha antes de imprimir
  document.getElementById('printBtn').addEventListener('click', ()=>{
    atualizarFolha();
    window.print();
  });
  // e também se o usuário apertar Ctrl+P direto
  window.onbeforeprint = atualizarFolha;
</script>
</body>
</html>
